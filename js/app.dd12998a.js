(function(e){function t(t){for(var r,o,a=t[0],l=t[1],h=t[2],u=0,d=[];u<a.length;u++)o=a[u],Object.prototype.hasOwnProperty.call(s,o)&&s[o]&&d.push(s[o][0]),s[o]=0;for(r in l)Object.prototype.hasOwnProperty.call(l,r)&&(e[r]=l[r]);c&&c(t);while(d.length)d.shift()();return n.push.apply(n,h||[]),i()}function i(){for(var e,t=0;t<n.length;t++){for(var i=n[t],r=!0,a=1;a<i.length;a++){var l=i[a];0!==s[l]&&(r=!1)}r&&(n.splice(t--,1),e=o(o.s=i[0]))}return e}var r={},s={app:0},n=[];function o(t){if(r[t])return r[t].exports;var i=r[t]={i:t,l:!1,exports:{}};return e[t].call(i.exports,i,i.exports,o),i.l=!0,i.exports}o.m=e,o.c=r,o.d=function(e,t,i){o.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:i})},o.r=function(e){"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},o.t=function(e,t){if(1&t&&(e=o(e)),8&t)return e;if(4&t&&"object"===typeof e&&e&&e.__esModule)return e;var i=Object.create(null);if(o.r(i),Object.defineProperty(i,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var r in e)o.d(i,r,function(t){return e[t]}.bind(null,r));return i},o.n=function(e){var t=e&&e.__esModule?function(){return e["default"]}:function(){return e};return o.d(t,"a",t),t},o.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},o.p="/";var a=window["webpackJsonp"]=window["webpackJsonp"]||[],l=a.push.bind(a);a.push=t,a=a.slice();for(var h=0;h<a.length;h++)t(a[h]);var c=l;n.push([0,"chunk-vendors"]),i()})({0:function(e,t,i){e.exports=i("56d7")},"0197":function(e,t,i){"use strict";i("586d")},"034f":function(e,t,i){"use strict";i("85ec")},1871:function(e,t,i){"use strict";i("5983")},1950:function(e,t,i){"use strict";i("1e3b")},"1e3b":function(e,t,i){},"56d7":function(e,t,i){"use strict";i.r(t);i("e260"),i("e6cf"),i("cca6"),i("a79d");var r=i("2b0e"),s=function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("v-app",{attrs:{id:"inspire"}},[i("v-app-bar",{attrs:{app:""}},[i("v-toolbar-title",[e._v("GCode Voxel Viewer by Sindarius")]),i("v-spacer"),i("v-btn",{on:{click:e.loadBenchy}},[e._v("Load a benchy!")])],1),i("v-main",{staticClass:"main-ref"},[i("asmbl-viewer",{ref:"viewer"})],1)],1)},n=[],o={data:function(){return{drawer:null}},methods:{loadBenchy:function(){this.$refs.viewer.loadBenchy()}}},a=o,l=(i("034f"),i("2877")),h=i("6544"),c=i.n(h),u=i("7496"),d=i("40dc"),g=i("8336"),b=i("f6c4"),p=i("2fa4"),f=i("2a7f"),v=Object(l["a"])(a,s,n,!1,null,null,null),m=v.exports;c()(v,{VApp:u["a"],VAppBar:d["a"],VBtn:g["a"],VMain:b["a"],VSpacer:p["a"],VToolbarTitle:f["a"]});var x=i("ce5b"),C=i.n(x),w=(i("53634"),function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("vue-draggable-resizable",{ref:"dragWindow",staticClass:"main-window",attrs:{hidden:!e.visible,"min-width":e.minWidth,"min-height":200,w:e.w,h:e.h,x:e.x,y:e.y,"drag-handle":e.dragHandle,parent:!0}},[i("div",{staticClass:"fill-area"},[i("v-toolbar",{staticClass:"drag-handle"},[i("v-btn",{staticClass:"close-button mr-1",attrs:{large:"",color:"error"},on:{click:e.hide}},[i("v-icon",[e._v("mdi-close")])],1),i("v-btn",{staticClass:"close-button mr-3",attrs:{large:"",color:"info"},on:{click:e.maximize}},[i("v-icon",[e._v(e._s(e.maximized?"mdi-window-restore":"mdi-window-maximize")+" ")])],1),i("v-toolbar-title",[e._v(e._s(e.title))])],1),i("main",{staticClass:"content-area"},[e._t("default")],2),i("footer",{staticClass:"footer"},[e._t("footer")],2)],1)])}),y=[],k=(i("a9e3"),i("96cf"),i("1da1")),M=i("fb19"),P=i.n(M);i("278f");r["default"].component("vue-draggable-resizable",P.a);var S={props:{visible:{type:Boolean,required:!0},title:String,startfull:{type:Boolean,default:!1},minWidth:{type:Number,default:300}},data:function(){return{dragHandle:".drag-handle",x:100,y:100,w:this.$props.minWidth,h:200,maximized:!1,restoreDimensions:{}}},methods:{maximize:function(){var e=this;return Object(k["a"])(regeneratorRuntime.mark((function t(){return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:if(!e.maximized){t.next=8;break}return e.maximized=!1,e.dragHandle=".drag-handle",t.next=5,e.$nextTick().then((function(){e.w=e.restoreDimensions.w,e.h=e.restoreDimensions.h}));case 5:return t.next=7,e.$nextTick().then((function(){e.x=e.restoreDimensions.x,e.y=e.restoreDimensions.y}));case 7:return t.abrupt("return");case 8:e.maximized=!0,e.dragHandle=".drag-handle-disabled",e.restoreDimensions={x:e.$refs.dragWindow.left,y:e.$refs.dragWindow.top,w:e.$refs.dragWindow.width,h:e.$refs.dragWindow.height},e.x=0,e.y=0,e.w=window.innerWidth,e.h=window.innerHeight;case 15:case"end":return t.stop()}}),t)})))()},hide:function(){this.$emit("update:visible",!1)}},watch:{visible:function(e){e&&this.startfull&&!this.maximized&&this.maximize()}}},F=S,A=(i("1871"),i("132d")),R=i("71d9"),V=Object(l["a"])(F,w,y,!1,null,"3d6261f0",null),T=V.exports;c()(V,{VBtn:g["a"],VIcon:A["a"],VToolbar:R["a"],VToolbarTitle:f["a"]}),r["default"].use(T);var B=function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("v-row",{attrs:{align:"center",justify:"center"}},[i("v-col",{staticClass:"shrink",style:[e.backgroundColorStyle]},[i("v-text-field",{staticClass:"ma-0 pa-0",attrs:{"hide-details":"",solo:""},on:{blur:function(t){return e.updateValue(e.internalTextColor)},keyup:function(t){return!t.type.indexOf("key")&&e._k(t.keyCode,"enter",13,t.key,"Enter")?null:e.updateValue(e.internalTextColor)}},scopedSlots:e._u([{key:"append",fn:function(){return[i("v-menu",{attrs:{"close-on-content-click":!1,"nudge-bottom":"105","nudge-left":"16",top:""},scopedSlots:e._u([{key:"activator",fn:function(t){var r=t.on;return[i("div",e._g({style:e.swatchStyle},r))]}}]),model:{value:e.menu,callback:function(t){e.menu=t},expression:"menu"}},[i("v-card",[i("v-card-text",{staticClass:"pa-0"},[i("v-color-picker",{staticClass:"index-placement",attrs:{flat:""},on:{input:function(t){return e.updateValue(e.color)}},model:{value:e.color,callback:function(t){e.color=t},expression:"color"}})],1)],1)],1)]},proxy:!0}]),model:{value:e.internalTextColor,callback:function(t){e.internalTextColor=t},expression:"internalTextColor"}})],1)],1)},O=[],I=(i("843c"),i("2ca0"),{props:["editcolor"],data:function(){return{internalTextColor:"#000000",color:"#000000",menu:!1}},computed:{backgroundColorStyle:function(){return{minWidth:"220px",backgroundColor:this.color}},swatchStyle:function(){var e=this.color,t=this.menu;return{backgroundColor:e,cursor:"pointer",height:"30px",width:"30px",borderRadius:t?"50%":"4px",transition:"border-radius 200ms ease-in-out"}}},mounted:function(){this.color=this.editcolor,this.internalTextColor=this.editcolor},methods:{updateValue:function(e){this.color=e,e.startsWith("#")||(this.color="#"+e),this.color=this.color.toUpperCase().padEnd(7,"0").substring(0,7),this.internalTextColor=this.color,this.$emit("update:editcolor",this.color)}},watch:{editcolor:{handler:function(e){this.color=e,this.internalTextColor=e}}}}),z=I,L=(i("1950"),i("b0af")),j=i("99d9"),H=i("62ad"),E=i("03a4"),D=i("e449"),N=i("0fd9"),G=i("8654"),W=Object(l["a"])(z,B,O,!1,null,"0e916049",null),q=W.exports;c()(W,{VCard:L["a"],VCardText:j["a"],VCol:H["a"],VColorPicker:E["a"],VMenu:D["a"],VRow:N["a"],VTextField:G["a"]});var U=function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("div",{staticClass:"bgcolor"},[i("v-btn",{attrs:{block:""},on:{click:function(t){return e.save()}}},[e._v("Save Tools")]),e._l(e.tools,(function(t,r){return i("v-card",{key:r,staticClass:"mb-2"},[i("v-card-title",[e._v(e._s(t.name))]),i("v-card-text",[i("v-row",[i("v-col",{attrs:{cols:"12"}},[i("div",{staticClass:"mb-2"},[e._v("Filamnt Color")]),i("color-picker",{attrs:{editcolor:t.colorString},on:{"update:editcolor":function(i){return e.$set(t,"colorString",i)}}})],1),i("v-col",{attrs:{cols:"12"}},[e._v(" Diameter "),i("v-text-field",{model:{value:t.diameter,callback:function(i){e.$set(t,"diameter",i)},expression:"tool.diameter"}})],1),i("v-col",{attrs:{cols:"12"}},[e._v(" Tool Type "),i("v-select",{attrs:{items:e.toolTypes},model:{value:t.toolType,callback:function(i){e.$set(t,"toolType",i)},expression:"tool.toolType"}})],1)],1)],1)],1)}))],2)},Q=[],Z=(i("4160"),i("a434"),i("b0c0"),i("159b"),i("53ca")),J=i("d4ec"),X=i("bee2"),K=i("5de6"),Y=function(){function e(){Object(J["a"])(this,e),this.name="",this.color=new K["b"](0,0,1,1),this.diameter=.4,this.toolType=_.Extruder}return Object(X["a"])(e,[{key:"colorString",get:function(){return this.color.toHexString()},set:function(e){this.color=K["b"].FromHexString(e+"FF")}},{key:"isAdditive",value:function(){return this.toolType===_.Extruder}},{key:"getDiameter",value:function(){return this.diameter}},{key:"toJson",value:function(){return JSON.stringify(this)}}],[{key:"fromJson",value:function(t){var i;i="object"===Object(Z["a"])(t)?t:JSON.parse(t);var r=new e;return r.name=i.name,r.color=new K["b"](i.color.r,i.color.g,i.color.b,i.color.a),r.diameter=parseFloat(i.diameter),r.toolType=i.toolType,r}}]),e}(),_={Extruder:"Extruder",Endmill:"Endmill"},$=new Array;function ee(){if(0===$.length){var e=window.localStorage.getItem("tools");if(e){$.splice();var t=JSON.parse(e);t.forEach((function(e){var t=Y.fromJson(e);$.push(t)}))}else for(var i=0;i<10;i++){var r=new Y;r.name="Tool #"+i,$.push(r)}}return $}function te(){var e=JSON.stringify($);window.localStorage.setItem("tools",e)}var ie={data:function(){return{toolCountValue:1,tools:new Array,toolTypes:["Extruder","Endmill"]}},mounted:function(){this.tools=ee()},methods:{save:function(){te()}},computed:{toolCount:{get:function(){return this.toolCountValue},set:function(e){console.log(e),e>10||e<1||(this.toolCountValue=e,console.log("TCV ".concat(this.toolCountValue)))}}}},re=ie,se=(i("0197"),i("b974")),ne=Object(l["a"])(re,U,Q,!1,null,null,null),oe=ne.exports;c()(ne,{VBtn:g["a"],VCard:L["a"],VCardText:j["a"],VCardTitle:j["b"],VCol:H["a"],VRow:N["a"],VSelect:se["a"],VTextField:G["a"]});var ae=function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("div",{directives:[{name:"resize",rawName:"v-resize",value:e.resize,expression:"resize"}]},[i("canvas",{ref:"gcodeViewer",staticClass:"canvas-size"}),i("div",{staticClass:"main-container"},[i("v-row",{attrs:{"no-gutters":""}},[i("v-col",{attrs:{cols:"12"}},[i("v-btn",{attrs:{title:"Load File"},on:{click:e.chooseFile}},[i("v-icon",[e._v("mdi-upload")]),e._v("Upload ")],1),i("v-btn",{staticClass:"ml-1",attrs:{title:"Reload With New Settings"},on:{click:e.reload}},[i("v-icon",[e._v("mdi-reload")]),e._v("Reload ")],1)],1),i("v-col",{attrs:{cols:"12"}},[i("span",{staticClass:"small-font-note"},[e._v("Reload after changing settings.")])]),i("v-col",{attrs:{cols:"12"}},[i("v-text-field",{staticClass:"input-width",attrs:{hint:"Voxel Width","persistent-hint":""},model:{value:e.voxelWidth,callback:function(t){e.voxelWidth=t},expression:"voxelWidth"}})],1),i("v-col",{attrs:{cols:"12"}},[i("v-text-field",{staticClass:"input-width",attrs:{hint:"Voxel Height","persistent-hint":""},model:{value:e.voxelHeight,callback:function(t){e.voxelHeight=t},expression:"voxelHeight"}})],1),i("v-col",{attrs:{cols:"12"}},[i("v-checkbox",{staticClass:"input-width",attrs:{hint:"Feed Rate Coloring","persistent-hint":""},model:{value:e.feedColoring,callback:function(t){e.feedColoring=t},expression:"feedColoring"}})],1),i("v-col",{attrs:{cols:"6"}}),i("v-col",{attrs:{cols:"6"}},[i("v-btn",{attrs:{title:"Reset Camera"},on:{click:e.resetCam}},[i("v-icon",[e._v("mdi-camera")])],1)],1)],1),i("input",{ref:"fileInput",attrs:{accept:".g,.gcode,.gc,.gco,.nc,.ngc,.tap",hidden:"",multiple:"",type:"file"},on:{change:e.fileSelected}})],1),i("div",{staticClass:"button-container",class:{"button-container-drawer":e.drawer}},[i("v-btn",{staticClass:"toggle-menu-button-close mb-10",attrs:{title:"Show Tools",color:"secondary",small:""},on:{click:function(t){e.drawer=!e.drawer}}},[i("v-icon",[e._v("mdi-cog")])],1)],1),i("v-navigation-drawer",{attrs:{permanent:e.drawer,absolute:"",width:"275"},model:{value:e.drawer,callback:function(t){e.drawer=t},expression:"drawer"}},[i("tool-configuration",{staticClass:"input-width"})],1),i("div",{staticClass:"loading-progress"},[i("div"),i("v-progress-linear",{directives:[{name:"show",rawName:"v-show",value:e.loading,expression:"loading"}],staticClass:"disable-transition",attrs:{value:e.loadingProgress,height:"15",rounded:""}},[i("span",{staticClass:"progress-font"},[e._v(e._s(e.loadingMessage)+e._s(e.loadingProgress)+"%")])])],1),i("div",{staticClass:"time-slider"},[i("v-row",{attrs:{"no-gutters":""}},[i("v-col",{attrs:{cols:"10"}},[i("v-slider",{attrs:{disabled:e.loading,label:e.filePositionString,max:e.fileSize,min:"0"},model:{value:e.filePosition,callback:function(t){e.filePosition=t},expression:"filePosition"}})],1),i("v-col",{attrs:{cols:"1"}},[i("v-btn",{on:{click:function(t){e.playing=!e.playing}}},[e.playing?i("v-icon",[e._v("mdi-pause")]):i("v-icon",[e._v("mdi-play")])],1)],1),i("v-col",{attrs:{cols:"1"}},[i("v-select",{attrs:{items:e.speeds},model:{value:e.playbackSpeedSelection,callback:function(t){e.playbackSpeedSelection=t},expression:"playbackSpeedSelection"}})],1),i("v-col",{attrs:{cols:"12"}},[e.loading?e._e():i("span",[e._v("Prsss play or use the scrubber to go through file.")])])],1)],1)],1)},le=[],he=(i("d3b7"),i("ac1f"),i("466d"),i("1276"),i("a942")),ce=i("b555"),ue=i("8f67"),de=i("fd24"),ge=i("498c"),be=i("3e3c"),pe=i("a958"),fe=(i("d768"),i("55f2")),ve=i("cd92"),me=(i("e5b6"),i("074d"),i("99af"),i("4de4"),i("c975"),i("fb6a"),i("45fc"),i("25eb"),i("498a"),i("cb84")),xe=i("91db"),Ce=i("a5b0"),we=i("2f17"),ye=(i("4fad"),i("3ca3"),i("cfc3"),i("9a8c"),i("a975"),i("735e"),i("c1ac"),i("d139"),i("3a7b"),i("d5d6"),i("82f8"),i("e91f"),i("60bd"),i("5f96"),i("3280"),i("3fcc"),i("ca91"),i("25a1"),i("cd26"),i("3c5d"),i("2954"),i("649e"),i("219c"),i("170b"),i("b39a"),i("72f7"),i("ddb0"),i("3835")),ke=i("262e"),Me=i("2caf"),Pe=i("ade3");i("caad"),i("2532");function Se(e,t,i){var r=Number(e.substring(1)),s=r||0;return i?s+t:s}function Fe(e,t,i,r){for(var s=t.x,n=t.z,o=t.y,a=s,l=n,h=o,c=0,u=0,d=0,g=e.some((function(e){return e.includes("G2")})),b=0;b<e.length;b++){var p=e[b];switch(p[0]){case"X":a=Se(p,a,i);break;case"Y":l=Se(p,l,i);break;case"Z":h=Se(p,h,i);break;case"I":c=Se(p,c,!1);break;case"J":u=Se(p,u,!1);break;case"R":d=Se(p,d,!1);break}}if(d){var f=a-s,v=l-n,m=Math.pow(f,2)+Math.pow(v,2),x=Math.pow(d,2)-m/4;if(0==m||x<0)return{position:{x:a,y:h,z:l},points:[]};var C=Math.sqrt(x/m);(g&&d<0||!g&&d>0)&&(C=-C),c=f/2+v*C,u=v/2-f*C}else if(0==c&&0==u)return{position:{x:a,y:l,z:h},points:[]};var w,y=s==c&&n==l,k=s+c,M=n+u,P=Math.sqrt(c*c+u*u),S=Math.atan2(-u,-c),F=Math.atan2(l-M,a-k);y?w=2*Math.PI:(w=g?S-F:F-S,w<0&&(w+=2*Math.PI));var A=P*w/r+.8;A<1&&(A=1);var R=w/A;R*=g?-1:1;for(var V=new Array,T=o-h,B=T/A,O=s,I=n,z=o,L=S,j=0;j<A-1;j++)L+=R,O=k+P*Math.cos(L),I=M+P*Math.sin(L),z+=B,V.push({x:O,y:z,z:I});return V.push({x:a,y:h,z:l}),{position:{x:a,y:h,z:l},points:V}}function Ae(){return new Promise((function(e){return setTimeout(e)})).then((function(){return Date.now()}))}var Re=function e(t,i,r,s,n){Object(J["a"])(this,e),this.scene=t,this.specularColor=i,this.loadingProgressCallback=r,this.renderFuncs=s,this.solidMat,this.transparentMat,this.previousFilePosition=0,this.currentFilePosition=0,this.tools=n},Ve=i("c003"),Te=(i("71d2"),i("6792"),function e(t,i){Object(J["a"])(this,e),this.filePosition=t,this.add=i}),Be=function(e){Object(ke["a"])(i,e);var t=Object(Me["a"])(i);function i(e,r,s,n,o,a,l){var h;return Object(J["a"])(this,i),h=t.call(this,e,n,o,a,l),h.voxelWidth=parseFloat(r),h.voxelHeight=parseFloat(s),h.solidMat,h.transparentMat,h.isLoading=!1,h.scrubDistance=2e3,h.hasSubtractive=!1,h}return Object(X["a"])(i,[{key:"updateFilePosition",value:function(e){this.previousFilePosition=this.currentFilePosition,this.currentFilePosition=e}},{key:"buildBox",value:function(){if(this.solidMat)try{this.solidMat.dispose(),this.solidMat=null}catch(i){}if(this.transparentMat)try{this.transparentMat.dispose(),this.transparentMat=null}catch(r){}var e=be["a"].CreateBox("box",{width:this.voxelWidth,height:this.voxelHeight,depth:this.voxelWidth},this.scene);e.hasVertexAlpha=!0,e.updateFacetData=!0;var t=new xe["a"]("mat",this.scene);return t.needDepthPrePass=!0,t.forceDepthWrite=!0,t.backFaceCulling=!1,e.material=t,e}},{key:"render",value:function(){var e=Object(k["a"])(regeneratorRuntime.mark((function e(t){var r,s,n,o,a,l,h,c,u,d,g,b,p,f,v,m,x,C,w,y,k,M,P,S,F=this;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:for(this.isLoading=!0,r=this,s=parseInt(300/this.voxelWidth)+1,n=s,o=parseInt(300/this.voxelHeight)+1,a=new Array(n),l=0;l<=o;l++)a[l]=new Object;h=0,0,c=new Date,u=0;case 11:if(!(u<t.length)){e.next=61;break}if(d=t[u],g=this.tools[d.tool],d.extruding){e.next=16;break}return e.abrupt("continue",58);case 16:if(b=d.getVoxelSegments(this.voxelWidth,this.voxelHeight,g.getDiameter()/2,g.isAdditive()),void 0!==b&&0!==b.length){e.next=19;break}return e.abrupt("continue",58);case 19:p=new Te(d.gcodeLineNumber,g.isAdditive()),f=0;case 21:if(!(f<b.length)){e.next=52;break}if(v=b[f],m=Math.floor(v.x/this.voxelWidth),x=Math.floor(v.y/this.voxelHeight),C=Math.floor(v.z/this.voxelWidth),x<0&&(x=0),x!=h&&g.isAdditive()&&(h=x),"Extruder"!==g.toolType){e.next=33;break}try{w=a[x][m][C]}catch(A){w=null}if(w)w.voxelEvents.push(p);else try{a[x].hasOwnProperty(m)||(a[x][m]={}),a[x][m][C]={color:d.color,voxelEvents:[p]}}catch(A){console.log(A),console.log("".concat(m,"  ").concat(x," ").concat(C))}e.next=49;break;case 33:this.hasSubtractive=!0,y=x;case 35:if(!(y<=h+1)){e.next=49;break}e.prev=36,a[y][m][C]?a[y][m][C].voxelEvents.push(p):(a[y].hasOwnProperty(m)||(a[y][m]={}),a[y][m][C]={color:d.color,voxelEvents:[p]}),e.next=46;break;case 40:if(e.prev=40,e.t0=e["catch"](36),!(y<0)){e.next=44;break}return e.abrupt("continue",46);case 44:a[y].hasOwnProperty(m)||(a[y][m]={}),a[y][m][C]={color:d.color,voxelEvents:[p]};case 46:y++,e.next=35;break;case 49:f++,e.next=21;break;case 52:if(t[u]=null,!(u%1e4===0||new Date-c>5e3)){e.next=58;break}return c=new Date,this.loadingProgressCallback(u/t.length,"Generating Voxel Map..."),e.next=58,Ae();case 58:u++,e.next=11;break;case 61:this.loadingProgressCallback(u/t.length,"Rendering Voxel..."),console.log(this.hasSubtractive),k=0,M=regeneratorRuntime.mark((function e(t){var s,n,o,l,u,d,g,b,p,f,v,m,x,C,w,y,M,P,S,R,V,T,B,O,I,z,L,j,H;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:if(s=[],void 0!==a[t]){e.next=3;break}return e.abrupt("return","continue");case 3:for(n=999999999999,o=-999999999999,l=0,u=Object.entries(a[t]);l<u.length;l++)for(d=Object(ye["a"])(u[l],2),g=d[0],b=d[1],p=0,f=Object.entries(b);p<f.length;p++)v=Object(ye["a"])(f[p],2),m=v[0],x=v[1],x.voxelEvents[0].filePosition<n&&(n=x.voxelEvents[0].filePosition),x.voxelEvents.slice()[0].filePosition>o&&(o=x.voxelEvents[0].filePosition),x.color.a=1,C={matrix:de["a"].Identity(),color:x.color.clone(),voxelEvents:x.voxelEvents,lastDrawnCount:0},C.matrix.setTranslation(new de["e"](g*F.voxelWidth,t*F.voxelHeight,m*F.voxelWidth)),s.push(C);for(k+=s.length,a[t]=null,w=F.buildBox(),w.alphaIndex=t,w.renderingGroupId=1,y=new Float32Array(16*s.length),M=new Float32Array(4*s.length),P=0;P<s.length;P++){S=s[P];try{S&&(S.matrix.copyToArray(y,16*P),S.color.toArray(M,4*P),F.hasSubtractive||delete S.matrix)}catch(A){console.log(A)}}if(w.thinInstanceSetBuffer("matrix",y,16),w.thinInstanceSetBuffer("color",M,4),w.thinInstanceRefreshBoundingInfo(),R=new K["b"](1,0,0,0),V=new K["b"](1,0,0,.8),T=new K["b"](0,1,0,.8),B=de["a"].Identity().setTranslation(new de["e"](1e4,1e4,1e4)),O=function(){for(var e=!1,t=!1,r=0;r<s.length;r++){var n=s[r];L&&(R.toArray(M,4*r),F.hasSubtractive&&B.copyToArray(y,16*r));var o=n.voxelEvents.filter((function(e){return e.filePosition<F.currentFilePosition})).slice(-1)[0];null!==o&&void 0!==o&&(o.add?(o.filePosition>I&&o.filePosition<=F.currentFilePosition&&(n.lastDrawnCount=0,F.hasSubtractive&&n.matrix.copyToArray(y,16*r)),L&&(n.lastDrawnCount=i.drawDelay),n.lastDrawnCount<i.drawDelay?(T.toArray(M,4*r),n.lastDrawnCount++):(n.color.toArray(M,4*r),F.hasSubtractive&&n.matrix.copyToArray(y,16*r))):(o.filePosition>=I&&o.filePosition<=F.currentFilePosition&&(n.lastDrawnCount=0),L&&(n.lastDrawnCount=i.drawDelay),n.lastDrawnCount<i.drawDelay?(V.toArray(M,4*r),n.lastDrawnCount++):(e=!0,R.toArray(M,4*r),F.hasSubtractive&&B.copyToArray(y,16*r),t=!0)))}w.thinInstanceBufferUpdated("color"),e&&w.thinInstanceRefreshBoundingInfo(),t&&(w.thinInstanceRefreshBoundingInfo(),w.thinInstanceBufferUpdated("matrix"))},I=0,z=!0,L=!1,j=Date.now(),H=function(){r.isLoading||Date.now()-j<200||(j=Date.now(),Math.abs(I-r.currentFilePosition)>r.scrubDistance||z?(L=!0,O(),z=!1):r.currentFilePosition>=n-3e4&&r.currentFilePosition<=o+3e4&&(L=!1,O()),I=r.currentFilePosition)},F.loadingProgressCallback&&F.loadingProgressCallback(t/h,"Rendering Voxels..."),F.renderFuncs.push(H),F.scene.registerBeforeRender(H),!(new Date-c>1e3)){e.next=34;break}return c=new Date,e.next=34,Ae();case 34:case"end":return e.stop()}}),e)})),P=0;case 66:if(!(P<h)){e.next=74;break}return e.delegateYield(M(P),"t1",68);case 68:if(S=e.t1,"continue"!==S){e.next=71;break}return e.abrupt("continue",71);case 71:P++,e.next=66;break;case 74:console.log(k),a=null,this.loadingProgressCallback(1),this.isLoading=!1;case 78:case"end":return e.stop()}}),e,this,[[36,40]])})));function t(t){return e.apply(this,arguments)}return t}()}]),i}(Re);Object(Pe["a"])(Be,"drawDelay",5);var Oe=function(){function e(){Object(J["a"])(this,e),this.tool=0,this.start,this.end,this.extruding=!1,this.gcodeLineNumber=0,this.color,this.feedRate=0,this.layerHeight=0}return Object(X["a"])(e,[{key:"length",value:function(){return this.distanceVector(this.start,this.end)}},{key:"renderLine",value:function(e){var t=[this.start,this.end],i=Ve["a"].CreateLines("lines",t,e);i.enableEdgesRendering(),i.edgesWidth=10,i.edgesColor=new K["b"](1,1,0,1)}},{key:"renderLineV2",value:function(){var e=be["a"].CreateTube("tube",{path:[this.start,this.end],radius:.2,tesselation:4,sideOrientation:Ve["a"].FRONTSIDE,updatable:!1});return e.doNotSyncBoundingInfo=!0,e}},{key:"distanceVector",value:function(e,t){var i=e.x-t.x,r=e.y-t.y,s=e.z-t.z;return Math.sqrt(i*i+r*r+s*s)}},{key:"renderLineV3",value:function(e,t){var i=this.distanceVector(this.start,this.end),r=Math.atan2(this.end.z-this.start.z,this.end.x-this.start.x);e.scaling.x=i,e.rotation.y=-r,e.position.x=this.start.x+i/2*Math.cos(r),e.position.y=this.start.y,e.position.z=this.start.z+i/2*Math.sin(r),e.color=this.color,e.materialIndex=t?1:0,e.props={gcodeLineNumber:this.gcodeLineNumber,originalColor:this.color}}},{key:"renderParticle",value:function(e){e.position.x=this.start.x,e.position.y=this.start.y,e.position.z=this.start.z,e.color=this.color}},{key:"getPoints",value:function(){return{points:[this.start,this.end],colors:[this.color,this.color]}}},{key:"getColor",value:function(){return this.extruding?new K["b"](1,1,1,1):new K["b"](1,0,0,1)}},{key:"getVoxelSegments",value:function(e,t){var i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,r=arguments.length>3?arguments[3]:void 0,s=new Array,n=this.distanceVector(this.start,this.end);if(!(n<.1)){var o=Math.round(100*(n/(e/2)-1))/100,a=Math.atan2(this.end.z-this.start.z,this.end.x-this.start.x);r&&(this.start.y-=e/2,this.end.y-=e/2);var l=this.start.clone(),h=0;s.push(l.clone());var c=e/2*Math.cos(a),u=e/2*Math.sin(a),d=0;0!==o&&(d=(this.end.y-this.start.y)/o);while(h<o){if(l.x+=c,l.y+=d,l.z+=u,s.push(l.clone()),i>e)for(var g=l.x-i;g<=l.x+i;g+=e)for(var b=l.z-i;b<l.z+i;b+=e)s.push(new de["e"](g,l.y,b));h++}if(s.push(this.end.clone()),this.layerHeight>t&&r){for(var p=[],f=0;f<s.length;f++)for(var v=s[f],m=1;m<Math.ceil(this.layerHeight/t);m++)p.push(new de["e"](v.x,v.y-m*t,v.z));s.push.apply(s,p)}return s}}}]),e}(),Ie={Block:1,Line:2,Point:3,Max:4,Voxel:5},ze={Color:0,Feed:1},Le=function(){function e(){Object(J["a"])(this,e),this.currentPosition=new de["e"](0,0,0),this.currentColor=new K["b"](.25,.25,.25,1),this.currentTool=0,this.renderVersion=Ie.Line,this.absolute=!0,this.lines=[],this.travels=[],this.sps,this.maxHeight=0,this.minHeight=0,this.lineCount=0,this.renderMode="",this.extruderCount=10,this.layerDictionary={},this.previousLayerHeight=0,this.currentLayerHeight=0,this.liveTracking=!1,this.liveTrackingShowSolid="true"===localStorage.getItem("showSolid"),this.materialTransparency=.3,this.gcodeLineIndex=[],this.gcodeFilePosition=0,this.refreshTime=200,this.timeStamp,this.lineLengthTolerance=.05,this.tools=new Array,this.progressColor=new K["b"](0,1,0,1),this.lineMeshIndex=0,this.scene,this.renderFuncs=[],this.meshBreakPoint=2e4,this.feedRateTrimming=!1,this.currentFeedRate=0,this.feedValues=0,this.numChanges=0,this.avgFeed=0,this.maxFeedRate=0,this.minFeedRate=Number.MAX_VALUE,this.underspeedPercent=1,this.colorMode=Number.parseInt(localStorage.getItem("processorColorMode")),this.colorMode||this.setColorMode(ze.Color),this.minColorRate=Number.parseInt(localStorage.getItem("minColorRate")),this.minColorRate||(this.minColorRate=1200,localStorage.setItem("minColorRate",this.minColorRate)),this.maxColorRate=Number.parseInt(localStorage.getItem("maxColorRate")),this.maxColorRate||(this.maxColorRate=3600,localStorage.setItem("maxColorRate",this.maxColorRate)),this.minFeedColorString=localStorage.getItem("minFeedColor"),this.minFeedColorString||(this.minFeedColorString="#0000FF"),this.minFeedColor=K["b"].FromHexString(this.minFeedColorString.padEnd(9,"F")),this.maxFeedColorString=localStorage.getItem("maxFeedColor"),this.maxFeedColorString||(this.maxFeedColorString="#FF0000"),this.maxFeedColor=K["b"].FromHexString(this.maxFeedColorString.padEnd(9,"F")),this.everyNthRow=0,this.currentRowIdx=-1,this.currentZ=0,this.renderTravels=!0,this.lineVertexAlpha=!1,this.forceWireMode="true"===localStorage.getItem("forceWireMode"),this.spreadLines=!1,this.spreadLineAmount=10,this.debug=!1,this.specularColor=new K["b"](.1,.1,.1,.1),this.lookAheadLength=500,this.cancelLoad=!1,this.loadingProgressCallback,this.hasSpindle=!1,this.voxelWidth=1,this.voxelHeight=1,this.voxelRenderer=null}return Object(X["a"])(e,[{key:"setProgressColor",value:function(e){this.progressColor=K["b"].FromHexString(e.padEnd(9,"F"))}},{key:"getMaxHeight",value:function(){return this.maxHeight}},{key:"getMinHeight",value:function(){return this.minHeight}},{key:"setRenderQualitySettings",value:function(e,t){this.renderVersion=Ie.Voxel}},{key:"initVariables",value:function(){this.currentPosition=new de["e"](0,0,0),this.cancelLoad=!1,this.absolute=!0,this.currentZ=0,this.currentRowIdx=-1,this.gcodeLineIndex=[],this.lineMeshIndex=0,this.lastExtrudedZHeight=0,this.previousLayerHeight=0,this.currentLayerHeight=0,this.minFeedRate=Number.MAX_VALUE,this.maxFeedRate=0,this.hasSpindle=!1,this.currentColor=new K["b"](1,1,1,1)}},{key:"processGcodeFile",value:function(){var e=Object(k["a"])(regeneratorRuntime.mark((function e(t,i,r){var s,n,o;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:if(this.initVariables(),this.currentTool=0,void 0!==i&&null!==i||(i=4),void 0!==t&&null!==t&&0!==t.length){e.next=5;break}return e.abrupt("return");case 5:s=t.split("\n"),"function"===typeof r&&r(),this.lineCount=s.length,this.debug&&console.info("Line Count : ".concat(this.lineCount)),this.setRenderQualitySettings(this.lineCount,i),this.currentColor=this.tools[0].color,s.reverse(),n=0,this.timeStamp=Date.now();case 14:if(!s.length){e.next=29;break}if(!this.cancelLoad){e.next=18;break}return this.cancelLoad=!1,e.abrupt("return");case 18:if(o=s.pop(),n+=o.length+1,o.trim(),o.startsWith(";")||this.processLine(o,n),!(Date.now()-this.timeStamp>10)){e.next=27;break}return this.loadingProgressCallback&&this.loadingProgressCallback(n/t.length,"Loading File..."),e.next=26,Ae();case 26:this.timeStamp=e.sent;case 27:e.next=14;break;case 29:this.renderTravels&&this.createTravelLines(this.scene),t={};case 31:case"end":return e.stop()}}),e,this)})));function t(t,i,r){return e.apply(this,arguments)}return t}()},{key:"processLine",value:function(){var e=Object(k["a"])(regeneratorRuntime.mark((function e(t,i){var r,s,n,o,a,l,h,c,u,d,g,b,p,f,v,m,x,C,w,y,k,M=this;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:if(r=t.indexOf(";"),r>-1&&(t=t.substring(0,r-1).trim()),t=t.toUpperCase(),n=t.match(/[GM]+[0-9.]+/),null==n){e.next=94;break}n=n.filter((function(e){return e.startsWith("G")||e.startsWith("M")})),e.t0=n[0],e.next="G0"===e.t0||"G1"===e.t0?9:"G2"===e.t0||"G3"===e.t0?51:"G28"===e.t0?59:"G90"===e.t0?62:"G91"===e.t0?64:"G92"===e.t0?66:"S"===e.t0?67:"M3"===e.t0||"M4"===e.t0?69:"M567"===e.t0?74:92;break;case 9:s=t.split(/(?=[GXYZEFUV])/),o=new Oe,o.tool=this.currentTool,o.gcodeLineNumber=i,o.start=this.currentPosition.clone(),o.layerHeight=this.currentLayerHeight-this.previousLayerHeight,"G1"!=n[0]||this.tools[this.currentTool].isAdditive()||(o.extruding=!0,o.color=this.tools[this.currentTool].color.clone()),a=1;case 17:if(!(a<s.length)){e.next=40;break}l=s[a],e.t1=l[0],e.next="X"===e.t1?22:"Y"===e.t1?24:"Z"===e.t1?26:"E"===e.t1?30:"F"===e.t1?32:37;break;case 22:return this.currentPosition.x=this.absolute?Number(l.substring(1)):this.currentPosition.x+Number(l.substring(1)),e.abrupt("break",37);case 24:return this.currentPosition.z=this.absolute?Number(l.substring(1)):this.currentPosition.z+Number(l.substring(1)),e.abrupt("break",37);case 26:return this.currentPosition.y=this.absolute?Number(l.substring(1)):this.currentPosition.y+Number(l.substring(1)),this.currentPosition.y<this.minHeight&&(this.minHeight=this.currentPosition.y),this.spreadLines&&(this.currentPosition.y*=this.spreadLineAmount),e.abrupt("break",37);case 30:return Number(l.substring(1))>0&&(o.extruding=!0,this.maxHeight=this.currentPosition.y),e.abrupt("break",37);case 32:return this.currentFeedRate=Number(l.substring(1)),this.currentFeedRate>this.maxFeedRate&&(this.maxFeedRate=this.currentFeedRate),this.currentFeedRate<this.minFeedRate&&(this.minFeedRate=this.currentFeedRate),this.colorMode===ze.Feed&&(h=(this.currentFeedRate-this.minColorRate)/(this.maxColorRate-this.minColorRate),this.currentColor=h>=1?this.maxFeedColor:h<=0?this.minFeedColor:K["b"].Lerp(this.minFeedColor,this.maxFeedColor,h)),e.abrupt("break",37);case 37:a++,e.next=17;break;case 40:if(o.end=this.currentPosition.clone(),this.debug&&(console.log("".concat(t,"   absolute:").concat(this.absolute)),console.log(i,o)),this.feedRateTrimming&&(this.feedValues+=this.currentFeedRate,this.numChanges++,this.avgFeed=this.feedValues/this.numChanges*this.underspeedPercent),!(this.everyNthRow>1&&o.extruding)){e.next=47;break}if(this.currentPosition.y>this.currentZ&&(this.currentRowIdx++,this.currentZ=this.currentPosition.y),!(this.currentRowIdx%this.everyNthRow!==0^this.currentRowIdx<2)){e.next=47;break}return e.abrupt("return");case 47:return c=this.hasSpindle&&"G1"===n[0],u=o.length()>=this.lineLengthTolerance,c||u&&o.extruding?(o.color=this.currentColor.clone(),this.lines.push(o),this.currentPosition.y>this.currentLayerHeight&&this.currentPosition.y<20&&(this.previousLayerHeight=this.currentLayerHeight,this.currentLayerHeight=this.currentPosition.y)):this.renderTravels&&!o.extruding&&(o.color=new K["b"](1,0,0,1),this.travels.push(o)),e.abrupt("break",92);case 51:return s=t.split(/(?=[GXYZIJFRE])/),d=t.indexOf("E")>0,g=s.filter((function(e){return"G2"===e})),b=Fe(s,this.currentPosition,!this.absolute,1),p=this.currentPosition.clone(),b.points.forEach((function(e,t){var i=new Oe;i.tool=M.currentTool,i.gcodeLineNumber=M.gcodeLineNumber,i.start=p.clone(),i.end=new de["e"](e.x,e.y,e.z),i.color=M.currentColor.clone(),i.extruding=d,M.debug&&(i.color=g?new K["b"](0,1,1,1):new K["b"](1,1,0,1),0==t&&(i.color=new K["b"](0,1,0,1))),p=i.end.clone(),M.lines.push(i)})),this.currentPosition=new de["e"](b.position.x,b.position.y,b.position.z),e.abrupt("break",92);case 59:return s=t.split(/(?=[GXYZ])/),1==s.length?this.currentPosition=new de["e"](0,0,0):(s.some((function(e){return"X"===e.trim()}))&&(this.currentPosition.x=0),s.some((function(e){return"Y"===e.trim()}))&&(this.currentPosition.z=0),s.some((function(e){return"Z"===e.trim()}))&&(this.currentPosition.y=0)),e.abrupt("break",92);case 62:return this.absolute=!0,e.abrupt("break",92);case 64:return this.absolute=!1,e.abrupt("break",92);case 66:return e.abrupt("break",92);case 67:return this.hasSpindle=!0,e.abrupt("break",92);case 69:return f=t.split(/(?=[SM])/),v=f.filter((function(e){return e.startsWith("S")})),v=v[0]?Number(v[0].substring(1)):0,v>0&&(this.hasSpindle=!0),e.abrupt("break",92);case 74:if(m=t.split(/(?=[PE])/),this.colorMode!==ze.Feed){e.next=77;break}return e.abrupt("break",92);case 77:x=1;case 78:if(!(x<m.length)){e.next=89;break}C=m[x],w=[1,1,1],e.t2=C[0],e.next="E"===e.t2?84:86;break;case 84:return this.extruderPercentage=C.substring(1).split(":"),e.abrupt("break",86);case 86:x++,e.next=78;break;case 89:for(y=0;y<this.extruderPercentage.length;y++)w[0]-=(1-this.tools[y].color.r)*this.extruderPercentage[y],w[1]-=(1-this.tools[y].color.g)*this.extruderPercentage[y],w[2]-=(1-this.tools[y].color.b)*this.extruderPercentage[y];return this.currentColor=new K["b"](w[0],w[1],w[2],.1),e.abrupt("break",92);case 92:e.next=96;break;case 94:t.startsWith("T")&&(this.currentPosition.z+=10,this.currentTool=Number.parseInt(t.substring(1)),this.colorMode!==ze.Feed&&(k=Number(t.substring(1))%this.extruderCount,k<0&&(k=0),this.currentColor=this.tools[k].color.clone())),this.debug&&console.log(t);case 96:if(!(this.lines.length>=this.meshBreakPoint)){e.next=101;break}return this.createScene(this.scene),e.next=100,Ae();case 100:this.lineMeshIndex++;case 101:case"end":return e.stop()}}),e,this)})));function t(t,i){return e.apply(this,arguments)}return t}()},{key:"renderLineMode",value:function(e){var t=this,i=Date.now(),r=!1,s=this.lineMeshIndex;this.gcodeLineIndex.push(new Array),this.renderMode="Line Rendering";var n=[],o=[];this.debug&&console.log(this.lines[0]);for(var a=this.lineVertexAlpha?this.materialTransparency:1,l=0;l<this.lines.length;l++){var h=this.lines[l];this.gcodeLineIndex[s].push(h.gcodeLineNumber);var c=h.getPoints(e);this.liveTracking?(c.colors[0].a=this.liveTrackingShowSolid?a:0,c.colors[1].a=this.liveTrackingShowSolid?a:0):(c.colors[0].a=a,c.colors[1].a=a),n.push(c.points),o.push(c.colors)}var u=be["a"].CreateLineSystem("m "+this.lineMeshIndex,{lines:n,colors:o,updatable:!0},e);n=null,o=null,u.isVisible=!0,u.isPickable=!1,u.markVerticesDataAsUpdatable(me["b"].ColorKind),u.material=new xe["a"]("m",e),u.material.backFaceCulling=!0,u.material.forceDepthWrite=!0,u.alphaIndex=s,u.renderingGroupId=2;var d=0,g=function(){if((t.liveTracking||r||t.gcodeFilePosition&&d>=t.gcodeLineIndex[s].length-1)&&!(Date.now()-i<t.refreshTime)){i=Date.now();var e=u.getVerticesData(me["b"].ColorKind);if(null!==e&&void 0!==e){for(var n=-1,o=-1,a=d;a<t.gcodeLineIndex[s].length;a++)t.gcodeLineIndex[s][a]<=t.gcodeFilePosition&&(n=a),t.gcodeLineIndex[s][a]<=t.gcodeFilePosition+t.lookAheadLength&&(o=a);for(var l=d;l<n;l++){var h=8*l;e[h]=t.progressColor.r,e[h+1]=t.progressColor.g,e[h+2]=t.progressColor.b,e[h+3]=t.progressColor.a,e[h+4]=t.progressColor.r,e[h+5]=t.progressColor.g,e[h+6]=t.progressColor.b,e[h+7]=t.progressColor.a}for(var c=n;c<o;c++){var g=8*c;e[g+3]=1,e[g+7]=1}d=n,u.updateVerticesData(me["b"].ColorKind,e,!0),t.gcodeFilePosition===Number.MAX_VALUE&&(r=!0)}else console.log("Failed to Load Color VBO")}};this.renderFuncs.push(g),e.registerBeforeRender(g)}},{key:"renderBlockMode",value:function(e){var t=this,i=Date.now(),r=!1,s=this.lineMeshIndex;this.gcodeLineIndex.push(new Array);var n=Math.floor(100*(this.currentLayerHeight-this.previousLayerHeight))/100;this.spreadLines&&(n/=this.spreadLineAmount),this.renderMode="Mesh Rendering";var o=be["a"].CreateBox("box",{width:1,height:n,depth:1.2*n},e),a=this.lines;this.gcodeLineIndex.push(new Array);var l=function(e,i,r){a[r].renderLineV3(e,t.lineVertexAlpha||t.liveTracking&&!t.liveTrackingShowSolid),t.gcodeLineIndex[s].push(e.props.gcodeLineNumber)},h=new Ce["a"]("gcodemodel"+s,e,{updatable:!0,enableMultiMaterial:!0,useVertexAlpha:!0});h.addShape(o,this.lines.length,{positionFunction:l}),h.buildMesh();var c=this.lineVertexAlpha?this.materialTransparency:1;this.liveTracking&&(c=this.liveTrackingShowSolid?c:0);var u=new xe["a"]("solidMaterial",e);u.specularColor=this.specularColor;var d=new xe["a"]("transparentMaterial",e);d.specularColor=this.specularColor,d.alpha=this.liveTrackingShowSolid?this.materialTransparency:c,d.needAlphaTesting=function(){return!0},d.separateCullingPass=!0,d.backFaceCulling=!0,h.setMultiMaterial([u,d]),h.setParticles(),h.computeSubMeshes(),h.mesh.alphaIndex=0,h.mesh.isPickable=!1,h.mesh.doNotSyncBoundingInfo=!0,h.updateParticle=function(e){t.gcodeLineIndex[s][e.idx]<t.gcodeFilePosition?(e.color=t.progressColor,e.materialIndex=0):t.gcodeLineIndex[s][e.idx]<t.gcodeFilePosition+t.lookAheadLength?(e.color=new K["b"](e.color.r,e.color.g,e.color.b,1),e.materialIndex=0):e.color=new K["b"](e.color.r,e.color.g,e.color.b,0)};var g=function(){if(t.liveTracking&&!r){if(Date.now()-i<t.refreshTime)return;i=Date.now(),h.setParticles(),h.computeSubMeshes(),t.gcodeFilePosition===Number.MAX_VALUE&&(r=!0)}};this.renderFuncs.push(g),e.registerBeforeRender(g),this.scene.clearCachedVertexData()}},{key:"renderPointMode",value:function(e){var t=this.lineMeshIndex;this.gcodeLineIndex.push(new Array),this.sps=new we["b"]("pcs"+t,1,e);var i=this.lines,r=function(e,t,r){i[r].renderParticle(e)};this.sps.addPoints(this.lines.length,r),this.sps.buildMeshAsync().then((function(e){e.material.pointSize=2}))}},{key:"createScene",value:function(){var e=Object(k["a"])(regeneratorRuntime.mark((function e(t){return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:if(this.renderVersion!==Ie.Line){e.next=4;break}this.renderLineMode(t),e.next=16;break;case 4:if(this.renderVersion!==Ie.Block){e.next=8;break}this.renderBlockMode(t),e.next=16;break;case 8:if(this.renderVersion!==Ie.Point){e.next=12;break}this.renderPointMode(t),e.next=16;break;case 12:if(this.renderVersion!==Ie.Voxel){e.next=16;break}return this.voxelRenderer=new Be(t,this.voxelWidth,this.voxelHeight,this.specularColor,this.loadingProgressCallback,this.renderFuncs,this.tools),e.next=16,this.voxelRenderer.render(this.lines);case 16:this.lines=[],this.scene.render();case 18:case"end":return e.stop()}}),e,this)})));function t(t){return e.apply(this,arguments)}return t}()},{key:"createTravelLines",value:function(e){for(var t=[],i=[],r=0;r<this.travels.length;r++){var s=this.travels[r],n=s.getPoints(e);t.push(n.points),i.push(n.colors)}var o=be["a"].CreateLineSystem("travels",{lines:t,colors:i,updatable:!1,useVertexAlpha:!1},e);o.isVisible=!1,this.travels=[]}},{key:"updateFilePosition",value:function(e){this.liveTracking?this.gcodeFilePosition=e-1:(this.gcodeFilePosition=0,this.voxelRenderer&&this.voxelRenderer.updateFilePosition(e))}},{key:"doFinalPass",value:function(){var e=this;this.liveTracking=!0,this.gcodeFilePosition=Number.MAX_VALUE,setTimeout((function(){e.liveTracking=!1}),this.refreshTime+200)}},{key:"updateMesh",value:function(){1===this.renderVersion?console.log("Version 1"):2===this.renderVersion&&console.log("Version 2")}},{key:"unregisterEvents",value:function(){for(var e=0;e<this.renderFuncs.length;e++)this.scene.unregisterBeforeRender(this.renderFuncs[e]),delete this.renderFuncs[e];this.renderFuncs=[]}},{key:"setLiveTracking",value:function(e){this.liveTracking=e}},{key:"setColorMode",value:function(e){e||(this.colorMode=ze.Color),localStorage.setItem("processorColorMode",e),this.colorMode=e}},{key:"updateMinFeedColor",value:function(e){localStorage.setItem("minFeedColor",e),this.minFeedColorString=e,this.minFeedColor=K["b"].FromHexString(e.padEnd(9,"F"))}},{key:"updateMaxFeedColor",value:function(e){localStorage.setItem("maxFeedColor",e),this.maxFeedColorString=e,this.maxFeedColor=K["b"].FromHexString(e.padEnd(9,"F"))}},{key:"updateColorRate",value:function(e,t){localStorage.setItem("minColorRate",e),localStorage.setItem("maxColorRate",t),this.minColorRate=e,this.maxColorRate=t}},{key:"updateForceWireMode",value:function(e){this.forceWireMode=e,localStorage.setItem("forceWireMode",e)}},{key:"setLiveTrackingShowSolid",value:function(e){this.liveTrackingShowSolid=e,localStorage.setItem("showSolid",e)}},{key:"zeros",value:function(e){for(var t=[],i=0;i<e[0];++i)t.push(1==e.length?0:this.zeros(e.slice(1)));return t}}]),e}(),je=i("d618"),He=i("fe80"),Ee={bed:0,box:1},De=function(){function e(t){Object(J["a"])(this,e),this.buildVolume={x:{min:0,max:350},y:{min:0,max:350},z:{min:0,max:300}};var i=localStorage.getItem("buildVolume");null!==i&&(this.buildVolume=JSON.parse(i)),this.renderMode=Number.parseInt(localStorage.getItem("renderBedMode")),this.renderMode||(this.renderMode=Ee.bed),this.bedMesh,this.isDelta=!1,this.scene=t,this.registerClipIgnore=function(){},this.bedLineColor="#0000FF",this.getBedColor()||this.setBedColor("#0000FF"),this.planeMaterial=this.buildGridMaterial(),this.boxMaterial=new xe["a"]("bedBoxMaterial",this.scene),this.boxMaterial.alpha=0,this.debug=!1}return Object(X["a"])(e,[{key:"setRenderMode",value:function(e){this.renderMode=e,localStorage.setItem("renderBedMode",this.renderMode),this.bedMesh&&(this.scene.removeMesh(this.bedMesh),this.bedMesh.dispose(!1,!0)),this.buildBed()}},{key:"buildBed",value:function(){if(!this.debug){if(this.bedMesh&&this.bedMesh.isDisposed()&&(this.bedMesh=null),this.bedMesh)return this.bedMesh;switch(this.renderMode){case Ee.bed:this.buildFlatBed();break;case Ee.box:this.buildBox();break}return this.bedMesh}}},{key:"setDelta",value:function(e){this.isDelta=e,this.setRenderMode(this.renderMode)}},{key:"buildFlatBed",value:function(){var e=this.getCenter(),t=this.getSize();if(this.isDelta){var i=Math.abs(this.buildVolume.x.max-this.buildVolume.x.min)/2;this.bedMesh=be["a"].CreateDisc("BuildPlate",{radius:i},this.scene),this.bedMesh.rotationQuaternion=new de["b"].RotationAxis(new de["e"](1,0,0),Math.PI/2),this.bedMesh.material=this.planeMaterial}else{var r=t.x,s=t.y;this.bedMesh=be["a"].CreatePlane("BuildPlate",{width:r,height:s},this.scene),this.bedMesh.material=this.planeMaterial,this.bedMesh.rotationQuaternion=new de["b"].RotationAxis(new de["e"](1,0,0),Math.PI/2),this.bedMesh.translate(new de["e"](e.x,0,e.y),1,ge["c"].WORLD)}this.registerClipIgnore(this.bedMesh)}},{key:"getCenter",value:function(){return{x:(this.buildVolume.x.max+this.buildVolume.x.min)/2,y:(this.buildVolume.y.max+this.buildVolume.y.min)/2,z:(this.buildVolume.z.max+this.buildVolume.z.min)/2}}},{key:"getSize",value:function(){return{x:Math.abs(this.buildVolume.x.max-this.buildVolume.x.min),y:Math.abs(this.buildVolume.y.max-this.buildVolume.y.min),z:Math.abs(this.buildVolume.z.max-this.buildVolume.z.min)}}},{key:"buildBox",value:function(){var e=this,t=this.getSize(),i=this.getCenter();if(this.isDelta){this.bedMesh=be["a"].CreateCylinder("bed",{diameterTop:t.x,diameterBottom:t.x,height:t.z},this.scene),this.bedMesh.position.x=i.x,this.bedMesh.position.y=i.z,this.bedMesh.position.z=i.x,this.bedMesh.alpha=0,this.bedMesh.diffuseColor=new K["b"](0,0,0,0),this.bedMesh.isPickable=!1,this.bedMesh.enableEdgesRendering(void 0,!0),this.bedMesh.renderingGroupId=2,this.scene.setRenderingAutoClearDepthStencil(2,!1,!1,!1);var r=new je["a"]("hl",this.scene,{isStroke:!0,blurTextureSizeRatio:3});r.addMesh(this.bedMesh,this.getBedColor4()),this.bedMesh.onBeforeRenderObservable.add((function(){e.scene.getEngine().setColorWrite(!1)})),this.bedMesh.onAfterRenderObservable.add((function(){e.scene.getEngine().setColorWrite(!0)})),this.registerClipIgnore(this.bedMesh)}else{this.bedMesh=be["a"].CreateBox("bed",{width:t.x,depth:t.y,height:t.z},this.scene);var s=this.getCenter();this.bedMesh.position.x=s.x-this.buildVolume.x.min,this.bedMesh.position.y=s.z-this.buildVolume.z.min,this.bedMesh.position.z=s.y-this.buildVolume.y.min,this.bedMesh.diffuseColor=new K["b"](0,0,0,0),this.bedMesh.enableEdgesRendering(),this.bedMesh.edgesWidth=100,this.bedMesh.material=this.boxMaterial,this.bedMesh.isPickable=!1,this.bedMesh.edgesColor=this.getBedColor4(),this.registerClipIgnore(this.bedMesh)}}},{key:"setVisibility",value:function(e){this.bedMesh&&this.bedMesh.setEnabled(e)}},{key:"commitBedSize",value:function(){localStorage.setItem("buildVolume",JSON.stringify(this.buildVolume)),this.setRenderMode(this.renderMode)}},{key:"buildGridMaterial",value:function(){var e=new He["a"]("bedMaterial",this.scene);return e.mainColor=new K["b"](0,0,0,0),e.lineColor=K["a"].FromHexString(this.getBedColor()),e.gridRatio=5,e.opacity=.8,e.majorUnitFrequency=10,e.minorUnitVisibility=.6,e.gridOffset=new de["e"](0,0,0),e}},{key:"getBedColor",value:function(){return localStorage.getItem("bedLineColor")}},{key:"setBedColor",value:function(e){localStorage.setItem("bedLineColor",e),this.planeMaterial&&(this.planeMaterial=this.buildGridMaterial(),this.dispose(),this.buildBed())}},{key:"getBedColor4",value:function(){return K["b"].FromHexString(this.getBedColor().padEnd(9,"F"))}},{key:"dispose",value:function(){this.bedMesh.dispose(!1,!0)}}]),e}(),Ne=(i("2b3d"),i("5698")),Ge=i("6824"),We=i("f7c4"),qe=function(){function e(t){Object(J["a"])(this,e),this.scene=t,this.checkerBoard="iVBORw0KGgoAAAANSUhEUgAAAQEAAAEBCAIAAAD3joeqAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAAJcEhZcwAADsMAAA7DAcdvqGQAAALnSURBVHhe7dZBEYQwFAVBWBtogAv+IhIEsZd4yGG6L/lPwFRl31jqPM/neeZghd98oUoD1GmAOg1QpwHqNECdBqjTAHUaoE4D1GmAOg1QpwHqNECdBqjTAHUaoE4D1GmAOg1QpwHqNECdBqjTAHUaoE4D1GmAOg1QpwHqNECdBqjTAHUaoE4D1GmAOg1QpwHqNECdBqjTAHUaoE4D1GmAOg1QpwHqNECdBqjTAHUaoE4D1GmAOg1QpwHqNECdBqjTAHUaoE4D1GmAOg1QpwHqNECdBqjTAHUaoE4D1GmAOg1QpwHqNECdBqjTAHUaoE4D1GmAOg1QpwHqNECdBqjTAHUaoE4D1GmAOg1QpwHqNECdBqjTAHUaoE4D1GmAOg1QpwHqNECdBqjTAHUaoE4D1GmAOg1QpwHqNECdBqjTAHUaoE4D1GmAOg1QpwHqNECdBqjTAHUaoE4D1GmAOg1QpwHqNECdBqjTAHUaoE4D1GmAOg1QpwHqNECdBqjb7/ueJyscxzHGmIMV9u/75skK7/te1zUHK/gLUacB6jRAnQao0wB1GqBOA9RpgDoNUKcB6jRAnQao0wB1GqBOA9RpgDoNUKcB6jRAnQao0wB1GqBOA9RpgDoNUKcB6jRAnQao0wB1GqBOA9RpgDoNUKcB6jRAnQao0wB1GqBOA9RpgDoNUKcB6jRAnQao0wB1GqBOA9RpgDoNUKcB6jRAnQao0wB1GqBOA9RpgDoNUKcB6jRAnQao0wB1GqBOA9RpgDoNUKcB6jRAnQao0wB1GqBOA9RpgDoNUKcB6jRAnQao0wB1GqBOA9RpgDoNUKcB6jRAnQao0wB1GqBOA9RpgDoNUKcB6jRAnQao0wB1GqBOA9RpgDoNUKcB6jRAnQao0wB1GqBOA9RpgDoNUKcB6jRAnQao0wB1GqBOA9RpgDoNUKcB6jRAnQao0wB1GqBOA9RpgDoNUKcB6jRAnQao0wB1GqBOA7Rt2x+drw1hSNi5LQAAAABJRU5ErkJggg==",this.xmark="data:image/png;base64,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",this.buildObjectMeshes=new Array,this.labels=new Array,this.labelSVGS=new Array,this.baseMaterial,this.highlightMaterial,this.cancelledMaterial,this.cancelledHighlightMaterial,this.showCancelObjects=!1,this.objectCallback,this.renderFailedCallback,this.labelCallback,this.registerClipIgnore,this.getMaxHeight,this.alphaLevel=.5,this.observableControls=null,this.showLabel=localStorage.getItem("showObjectLabels"),null===this.showLabel?this.showLabel=!0:this.showLabel=JSON.parse(this.showLabel),this.rebuildMaterials()}return Object(X["a"])(e,[{key:"setBuildMaterial",value:function(e,t,i){i||(i=this.alphaLevel);var r=new xe["a"](e,this.scene);return r.diffuseColor=t,r.specularColor=new K["a"](0,0,0),r.alpha=i,r.needAlphaTesting=function(){return!0},r.separateCullingPass=!0,r.backFaceCulling=!0,r}},{key:"rebuildMaterials",value:function(){this.baseMaterial=this.setBuildMaterial("BuildObjectBaseMaterial",new K["b"](.1,.5,.1),.25),this.highlightMaterial=this.setBuildMaterial("BuildObjectHighlightMateria",new K["a"](.8,.8,.8)),this.cancelledMaterial=this.setBuildMaterial("BuildObjectHighlightMateria",new K["a"](1,0,0),.4),this.cancelledHighlightMaterial=this.setBuildMaterial("BuildObjectHighlightMateria",new K["a"](1,1,0),.6);var e=new Ge["a"].CreateFromBase64String(this.xmark,"checkerboard",this.scene);this.cancelledMaterial.diffuseTexture=e,this.cancelledHighlightMaterial.diffuseTexture=e}},{key:"loadObjectBoundaries",value:function(e){if(this.rebuildMaterials(),this.buildObjectMeshes.length>0){for(var t=0;t<this.buildObjectMeshes.length;t++)this.buildObjectMeshes[t].dispose();this.labelSVGS.forEach((function(e){return window.URL.revokeObjectURL(e)})),this.buildObjectMeshes=new Array,this.labels=new Array}if(e)for(var i=0;i<e.length;i++){var r=e[i],s=be["a"].CreateTiledBox("OBJECTMESH:"+r.name,{pattern:Ve["a"].CAP_ALL,alignVertical:Ve["a"].TOP,alignHorizontal:Ve["a"].LEFT,tileHeight:4,tileWidth:4,width:Math.abs(r.x[1]-r.x[0]),height:this.getMaxHeight()+10,depth:Math.abs(r.y[1]-r.y[0]),sideOrientation:Ve["a"].FRONTSIDE},this.scene);s.position.x=(r.x[1]+r.x[0])/2,s.position.y=this.getMaxHeight()/2-4,s.position.z=(r.y[1]+r.y[0])/2,s.alphaIndex=5e6,r.index=i,s.metadata=r,s.enablePointerMoveEvents=!0,s.renderingGroupId=3,this.setObjectTexture(s),s.setEnabled(this.showCancelObjects),this.registerClipIgnore(s),this.buildObjectMeshes.push(s);var n=this.makeTextPlane(r.name,r.cancelled?"yellow":"white",20);n.position=new de["e"](0,this.getMaxHeight()/2+10,0),n.isPickable=!1,n.metadata=r,n.parent=s,n.setEnabled(this.showLabel),this.labels.push(n)}}},{key:"makeTextPlane",value:function(e,t,i){var r=Ne["a"]("svg").attr("width",800).attr("height",200).attr("fill","none");r.append("text").attr("x",400).attr("y",100).attr("font-family","Verdana").attr("font-size","50px").attr("text-anchor","middle").attr("alignment-baseline","middle").attr("fill","black").attr("stroke",t).attr("stroke-width",2).attr("text-rendering","optimizeLegibility").text(e);var s=r.attr("title","test2").attr("version",1.1).attr("xmlns","http://www.w3.org/2000/svg").node(),n='<?xml version="1.0" standalone="no"?><!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN" "http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd">',o=(new XMLSerializer).serializeToString(s),a=new Blob([n+o],{type:"image/svg+xml"}),l=window.URL.createObjectURL(a);this.labelSVGS.push(l);var h=be["a"].CreatePlane("TextPlane",{width:i,height:8},this.scene);return h.material=new xe["a"]("TextPlaneMaterial",this.scene),h.material.backFaceCulling=!1,h.material.specularColor=new K["a"](0,0,0),h.material.diffuseTexture=new Ge["a"](l,this.scene),h.material.diffuseTexture.hasAlpha=!0,h.billboardMode=7,this.registerClipIgnore(h),h}},{key:"buildObservables",value:function(){var e=this;if(!this.observableControls){var t=0,i=!1,r=0;this.observableControls=this.scene.onPointerObservable.add((function(s){var n=s.pickInfo;switch(s.type){case We["a"].POINTERDOWN:i=!0,r=Date.now();break;case We["a"].POINTERUP:if(i=!1,Date.now()-r>200)return;e.handleClick(n);break;case We["a"].POINTERMOVE:if(i||Date.now()-t<100)return;t=Date.now(),e.handlePointerMove(n)}}))}}},{key:"clearObservables",value:function(){this.observableControls&&(this.scene.onPointerObservable.remove(this.observableControls),this.observableControls=null)}},{key:"showObjectSelection",value:function(e){this.showCancelObjects=e,this.buildObjectMeshes.forEach((function(t){return t.setEnabled(e)})),e?this.buildObservables():this.clearObservables()}},{key:"setObjectTexture",value:function(e){e.metadata.cancelled?(e.material=this.cancelledMaterial,e.enableEdgesRendering(),e.edgesWidth=15,e.edgesColor=new K["b"](1,0,0,1)):(e.material=this.baseMaterial,e.enableEdgesRendering(),e.edgesWidth=15,e.edgesColor=new K["b"](0,1,0,1))}},{key:"handleClick",value:function(e){this.showCancelObjects&&e.hit&&e.pickedMesh&&e.pickedMesh.name.includes("OBJECTMESH")&&this.objectCallback&&this.objectCallback(e.pickedMesh.metadata)}},{key:"handlePointerMove",value:function(e){var t=this;this.showCancelObjects&&(this.buildObjectMeshes.forEach((function(e){return t.setObjectTexture(e)})),e.hit&&e.pickedMesh&&e.pickedMesh.name.includes("OBJECTMESH")?(e.pickedMesh.material=e.pickedMesh.metadata.cancelled?this.cancelledHighlightMaterial:this.highlightMaterial,this.labelCallback&&this.labelCallback(e.pickedMesh.metadata.name)):this.labelCallback&&this.labelCallback(""))}},{key:"showLabels",value:function(e){localStorage.setItem("showObjectLabels",e),this.showLabel=e,this.labels.forEach((function(t){return t.setEnabled(e)}))}}]),e}(),Ue=i("5ab0"),Qe=function(){function e(t){Object(J["a"])(this,e),this.visible=localStorage.getItem("axesVisible"),null===this.visible?this.visible=!0:this.visible=JSON.parse(this.visible),this.scene=t,this.registerClipIgnore=function(){},this.axesMesh,this.size=50,this.debug=!1}return Object(X["a"])(e,[{key:"show",value:function(e){localStorage.setItem("axesVisible",e),this.axesMesh&&this.axesMesh.setEnabled(e)}},{key:"makeTextPlane",value:function(e,t,i){var r=new Ue["a"]("DynamicTexture",50,this.scene,!0);r.hasAlpha=!0,r.drawText(e,5,40,"bold 36px Arial",t,"transparent",!0);var s=Ve["a"].CreatePlane("TextPlane",i,this.scene,!0);return s.material=new xe["a"]("TextPlaneMaterial",this.scene),s.material.backFaceCulling=!1,s.material.specularColor=new K["a"](0,0,0),s.material.diffuseTexture=r,s}},{key:"resize",value:function(e){this.size=e,this.axesMesh.dispose(!1,!0),this.render()}},{key:"render",value:function(){var e=this;if(!this.debug&&(!this.axesMesh||this.axesMesh.isDisposed())){this.axesMesh=new Ve["a"]("axis"),this.registerClipIgnore(this.axesMesh);var t=Ve["a"].CreateLines("axisX",[de["e"].Zero(),new de["e"](this.size,0,0),new de["e"](.95*this.size,.05*this.size,0),new de["e"](this.size,0,0),new de["e"](.95*this.size,-.05*this.size,0)],this.scene);t.color=new K["a"](1,0,0),t.parent=this.axesMesh;var i=this.makeTextPlane("X","red",this.size/10);i.position=new de["e"](.9*this.size,.05*this.size,0),i.parent=this.axesMesh;var r=Ve["a"].CreateLines("axisY",[de["e"].Zero(),new de["e"](0,this.size,0),new de["e"](-.05*this.size,.95*this.size,0),new de["e"](0,this.size,0),new de["e"](.05*this.size,.95*this.size,0)],this.scene);r.color=new K["a"](0,0,1),r.parent=this.axesMesh;var s=this.makeTextPlane("Z","blue",this.size/10);s.position=new de["e"](0,.9*this.size,-.05*this.size),s.parent=this.axesMesh;var n=Ve["a"].CreateLines("axisZ",[de["e"].Zero(),new de["e"](0,0,this.size),new de["e"](0,-.05*this.size,.95*this.size),new de["e"](0,0,this.size),new de["e"](0,.05*this.size,.95*this.size)],this.scene);n.color=new K["a"](0,1,0),n.parent=this.axesMesh;var o=this.makeTextPlane("Y","green",this.size/10);o.position=new de["e"](0,.05*this.size,.9*this.size),o.parent=this.axesMesh,this.axesMesh.setEnabled(this.visible),this.axesMesh.getChildren().forEach((function(t){return e.registerClipIgnore(t)}))}}}]),e}(),Ze=function(){function e(t){Object(J["a"])(this,e),this.lastLoadKey="lastLoadFailed",this.fileData,this.fileSize=0,this.gcodeProcessor=new Le,this.maxHeight=0,this.minHeight=0,this.sceneBackgroundColor="#000000",this.canvas=t,this.scene={},this.loading=!1,this.toolVisible=!1,this.toolCursor,this.toolCursorMesh,this.toolCursorVisible=!0,this.travelVisible=!1,this.debug=!1,this.zTopClipValue,this.zBottomClipValue,this.cancelHitTimer=0,this.pause=!1,this.cameraInertia="true"===localStorage.getItem("cameraInertia"),this.bed,this.buildObjects,this.axes,this.renderQuality=Number(localStorage.getItem("renderQuality")),void 0!==this.renderQuality&&null!==this.renderQuality||(this.renderQuality=1),this.hasCacheSupport=!1}return Object(X["a"])(e,[{key:"getMaxHeight",value:function(){return this.maxHeight}},{key:"getMinHeight",value:function(){return this.minHeight}},{key:"setCameraType",value:function(e){this.scene.activeCamera=e?this.orbitCamera:this.flyCamera}},{key:"setZClipPlane",value:function(e,t){this.zTopClipValue=-e,this.zBottomClipValue=t,t>e&&(this.zTopClipValue=t+1),this.scene.clipPlane=new ue["a"](0,1,0,this.zTopClipValue),this.scene.clipPlane2=new ue["a"](0,-1,0,this.zBottomClipValue)}},{key:"init",value:function(){var e=this;this.engine=new he["a"](this.canvas,!0,{doNotHandleContextLost:!0}),this.engine.enableOfflineSupport=!1,this.scene=new ce["a"](this.engine),this.debug&&this.scene.debugLayer.show({embedMode:!0}),this.scene.clearColor=K["a"].FromHexString(this.getBackgroundColor()),this.bed=new De(this.scene),this.bed.registerClipIgnore=function(t){e.registerClipIgnore(t)};var t=this.bed.getCenter();this.orbitCamera=new fe["a"]("Camera",Math.PI/2,2.356194,250,new de["e"](t.x,-2,t.y),this.scene),this.orbitCamera.invertRotation=!1,this.orbitCamera.attachControl(this.canvas,!1),this.orbitCamera.maxZ=1e5,this.updateCameraInertiaProperties();var i=new ve["a"]("light2",new de["e"](0,1,-1),this.scene);i.diffuse=new K["a"](1,1,1),i.specular=new K["a"](1,1,1);var r=this;this.engine.runRenderLoop((function(){r.pause||(r.scene.render(),i.position=r.scene.cameras[0].position)})),this.buildObjects=new qe(this.scene),this.buildObjects.getMaxHeight=function(){return e.gcodeProcessor.getMaxHeight()},this.buildObjects.registerClipIgnore=function(t){e.registerClipIgnore(t)},this.bed.buildBed(),this.axes=new Qe(this.scene),this.axes.registerClipIgnore=function(t){e.registerClipIgnore(t)},this.axes.render(50),this.resetCamera()}},{key:"resize",value:function(){this.engine.resize()}},{key:"refreshUI",value:function(){setTimeout((function(){}),0)}},{key:"setFileName",value:function(e){this.hasCacheSupport&&window.caches.open("gcode-viewer").then((function(t){var i=new Blob([e],{type:"text/plain"});t.put("gcodeFileName",new Response(i))}))}},{key:"getFileName",value:function(){if(!this.hasCacheSupport)return"";window.caches.open("gcode-viewer").then((function(e){e.match("gcodeData").then((function(e){e.text().then((function(e){return e}))}))}))}},{key:"resetCamera",value:function(){var e=this.bed.getCenter(),t=this.bed.getSize();this.scene.activeCamera.alpha=Math.PI/2,this.scene.activeCamera.beta=2.356194,this.bed.isDelta?(this.scene.activeCamera.radius=e.x,this.scene.activeCamera.target=new de["e"](e.x,-2,e.y),this.scene.activeCamera.position=new de["e"](-t.x,t.z,-t.x)):(this.scene.activeCamera.radius=250,this.scene.activeCamera.target=new de["e"](e.x,-2,e.y),this.scene.activeCamera.position=new de["e"](-t.x/2,t.z,-t.y/2))}},{key:"lastLoadFailed",value:function(){return!!localStorage&&"true"===localStorage.getItem(this.lastLoadKey)}},{key:"setLoadFlag",value:function(){localStorage&&localStorage.setItem(this.lastLoadKey,"true")}},{key:"clearLoadFlag",value:function(){localStorage&&(localStorage.setItem(this.lastLoadKey,""),localStorage.removeItem(this.lastLoadKey))}},{key:"processFile",value:function(){var e=Object(k["a"])(regeneratorRuntime.mark((function e(t){var i;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return this.clearScene(),this.refreshUI(),i=this,this.hasCacheSupport&&window.caches.open("gcode-viewer").then((function(e){var i=new Blob([t],{type:"text/plain"});e.put("gcodeData",new Response(i))})),this.fileData=t,this.fileSize=t.length,this.gcodeProcessor.setProgressColor(this.getProgressColor()),this.gcodeProcessor.scene=this.scene,this.lastLoadFailed()&&(console.error("Last rendering failed dropping to SBC quality"),this.updateRenderQuality(1),this.clearLoadFlag()),this.setLoadFlag(),e.next=12,this.gcodeProcessor.processGcodeFile(t,this.renderQuality,(function(){i.hasCacheSupport&&(i.fileData="")}));case 12:return this.clearLoadFlag(),e.next=15,this.gcodeProcessor.createScene(this.scene);case 15:this.maxHeight=this.gcodeProcessor.getMaxHeight(),this.minHeight=this.gcodeProcessor.getMinHeight(),this.toggleTravels(this.travelVisible),this.setCursorVisiblity(this.toolCursorVisible);case 19:case"end":return e.stop()}}),e,this)})));function t(t){return e.apply(this,arguments)}return t}()},{key:"toggleTravels",value:function(e){var t=this.scene.getMeshByName("travels");if(void 0!==t)try{t.isVisible=e,this.travelVisible=e}catch(i){}}},{key:"getExtruderColors",value:function(){var e=localStorage.getItem("extruderColors");return null===e?(e=["#00FFFF","#FF00FF","#FFFF00","#000000","#FFFFFF"],this.saveExtruderColors(e)):e=e.split(","),e}},{key:"saveExtruderColors",value:function(e){localStorage.setItem("extruderColors",e)}},{key:"resetExtruderColors",value:function(){localStorage.removeItem("extruderColors"),this.getExtruderColors()}},{key:"getProgressColor",value:function(){var e=localStorage.getItem("progressColor");return null===e&&(e="#FFFFFF"),e}},{key:"setProgressColor",value:function(e){localStorage.setItem("progressColor",e),this.gcodeProcessor.setProgressColor(e)}},{key:"getBackgroundColor",value:function(){var e=localStorage.getItem("sceneBackgroundColor");return null===e&&(e="#000000"),e}},{key:"setBackgroundColor",value:function(e){null!==this.scene&&void 0!==this.scene&&(e.length>7&&(e=e.substring(0,7)),this.scene.clearColor=K["a"].FromHexString(e)),localStorage.setItem("sceneBackgroundColor",e)}},{key:"clearScene",value:function(e){this.fileData&&e&&(this.fileData=""),this.gcodeProcessor.unregisterEvents();for(var t=this.scene.meshes.length-1;t>=0;t--){var i=this.scene.meshes[t];i&&this.debug&&console.log("Disposing ".concat(i.name)),this.scene.removeMesh(i),i&&"function"===typeof i.dispose&&i.dispose(!1,!0)}for(var r=this.scene.materials.length-1;r>=0;r--){var s=this.scene.materials[r];"solidMaterial"===s.name&&(s&&this.debug&&console.log("Disposing ".concat(s.name)),this.scene.removeMaterial(s),s&&"function"===typeof s.dispose&&s.dispose(!1,!0))}this.toolCursor&&(this.toolCursor.dispose(!1,!0),this.toolCursor=void 0),this.buildtoolCursor(),this.bed.buildBed(),this.axes.render()}},{key:"reload",value:function(){var e=this;return new Promise((function(t){if(e.clearScene(),e.hasCacheSupport){var i=e;window.caches.open("gcode-viewer").then((function(e){e.match("gcodeData").then((function(e){e.text().then((function(e){i.processFile(e).then((function(){t()}))}))}))}))}else e.processFile(e.fileData).then((function(){t()}))}))}},{key:"getRenderMode",value:function(){return this.gcodeProcessor.renderMode}},{key:"setCursorVisiblity",value:function(e){void 0!==this.scene&&(void 0===this.toolCursor&&this.buildtoolCursor(),this.toolCursorMesh.isVisible=e,this.toolCursorVisible=e)}},{key:"updateToolPosition",value:function(e){var t=0,i=0,r=0;this.buildtoolCursor();for(var s=0;s<e.length;s++){switch(e[s].axes){case"X":t=e[s].position;break;case"Y":i=e[s].position;break;case"Z":r=e[s].position*(this.gcodeProcessor.spreadLines?this.gcodeProcessor.spreadLineAmount:1);break}this.toolCursor.setAbsolutePosition(new de["e"](t,r,i))}}},{key:"buildtoolCursor",value:function(){void 0===this.toolCursor&&(this.toolCursor=new pe["a"]("toolCursorContainer"),this.toolCursorMesh=be["a"].CreateCylinder("toolCursorMesh",{diameterTop:0,diameterBottom:1},this.scene),this.toolCursorMesh.parent=this.toolCursor,this.toolCursorMesh.position=new de["e"](0,3,0),this.toolCursorMesh.rotate(ge["a"].X,Math.PI,ge["c"].LOCAL),this.toolCursorMesh.scaling=new de["e"](3,3,3),this.toolCursorMesh.isVisible=this.toolCursorVisible,this.registerClipIgnore(this.toolCursorMesh))}},{key:"updateRenderQuality",value:function(e){this.renderQuality=e,localStorage&&localStorage.setItem("renderQuality",e)}},{key:"registerClipIgnore",value:function(e){var t=this;void 0!==e&&null!==e&&(e.onBeforeRenderObservable.add((function(){t.scene.clipPlane=null,t.scene.clipPlane2=null})),e.onAfterRenderObservable.add((function(){t.scene.clipPlane=new ue["a"](0,1,0,t.zTopClipValue),t.scene.clipPlane2=new ue["a"](0,-1,0,t.zBottomClipValue)})))}},{key:"updateCameraInertiaProperties",value:function(){this.cameraInertia?(this.orbitCamera.speed=2,this.orbitCamera.inertia=.9,this.orbitCamera.panningInertia=.9,this.orbitCamera.inputs.attached.keyboard.angularSpeed=.005,this.orbitCamera.inputs.attached.keyboard.zoomingSensibility=2,this.orbitCamera.inputs.attached.keyboard.panningSensibility=2,this.orbitCamera.angularSensibilityX=1e3,this.orbitCamera.angularSensibilityY=1e3,this.orbitCamera.panningSensibility=10,this.orbitCamera.wheelPrecision=1):(this.orbitCamera.speed=500,this.orbitCamera.inertia=0,this.orbitCamera.panningInertia=0,this.orbitCamera.inputs.attached.keyboard.angularSpeed=.05,this.orbitCamera.inputs.attached.keyboard.zoomingSensibility=.5,this.orbitCamera.inputs.attached.keyboard.panningSensibility=.5,this.orbitCamera.angularSensibilityX=200,this.orbitCamera.angularSensibilityY=200,this.orbitCamera.panningSensibility=2,this.orbitCamera.wheelPrecision=.25)}},{key:"setCameraInertia",value:function(e){this.cameraInertia=e,localStorage.setItem("cameraInertia",e),this.updateCameraInertiaProperties()}}]),e}(),Je=null,Xe={data:function(){return{drawer:!1,loading:!1,loadingProgress:0,loadingMessage:"",voxelWidth:1,voxelHeight:1,feedColoring:!0,minColorRate:0,maxColorRate:6e3,extruderColors:["#00FFFF","#FF00FF","#FFFF00","#000000","#FFFFFF"],fileSize:0,filePosition:0,playing:!1,speeds:[{text:"0.5x",value:50},{text:"1x",value:100},{text:"2x",value:200},{text:"5x",value:500},{text:"10x",value:1e3}],playbackSpeedSelection:100}},computed:{filePositionString:function(){return"".concat(this.filePosition)}},mounted:function(){var e=this;this.playbackSpeedSelection=100,Je=new Ze(this.$refs.gcodeViewer),Je.init(),Je.gcodeProcessor.loadingProgressCallback=function(t,i){e.loadingMessage=i,e.loadingProgress=Math.ceil(100*t),e.loadingProgress>99?e.loading=!1:e.loading=!0},Je.gcodeProcessor.tools=ee(),Je.setCursorVisiblity(!1),Je.gcodeProcessor.colorMode=ze.Feed,Je.gcodeProcessor.renderMode=Ie.voxel,Je.gcodeProcessor.meshBreakPoint=Number.MAX_VALUE,Je.setZClipPlane(1e6,-1e6),setInterval((function(){e.playing&&(e.filePosition+=e.playbackSpeedSelection,Je.gcodeProcessor.updateFilePosition(e.filePosition))}),200)},methods:{resize:function(){null!==Je&&Je.resize()},fileSelected:function(e){var t=this;return Object(k["a"])(regeneratorRuntime.mark((function i(){var r;return regeneratorRuntime.wrap((function(i){while(1)switch(i.prev=i.next){case 0:t.updateViewerSettings(),r=new FileReader,r.addEventListener("load",function(){var e=Object(k["a"])(regeneratorRuntime.mark((function e(i){var r;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return r=i.target.result,Je.gcodeProcessor.updateFilePosition(r.length),e.next=4,Je.processFile(r);case 4:t.fileSize=Je.fileSize;case 5:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()),t.loading=!0,Je.gcodeProcessor.colorMode=t.feedColoring?ze.Feed:ze.Color,r.readAsText(e.target.files[0]),e.target.value="";case 7:case"end":return i.stop()}}),i)})))()},updateExtruderColor:function(e,t){this.$set(this.extruderColors,e,t),Je.saveExtruderColors(this.extruderColors)},chooseFile:function(){this.$refs.fileInput.click()},resetCam:function(){Je.resetCamera()},reload:function(){var e=this;return Object(k["a"])(regeneratorRuntime.mark((function t(){return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return e.loading=!0,e.updateViewerSettings(),t.next=4,Je.reload();case 4:case"end":return t.stop()}}),t)})))()},updateViewerSettings:function(){Je.gcodeProcessor.tools=ee(),Je.gcodeProcessor.voxelWidth=isNaN(this.voxelWidth)||""===this.voxelWidth?3:this.voxelWidth,Je.gcodeProcessor.voxelHeight=isNaN(this.voxelHeight)||""===this.voxelHeight?3:this.voxelHeight,Je.gcodeProcessor.minColorRate=isNaN(this.minColorRate)?0:this.minColorRate,Je.gcodeProcessor.maxColorRate=isNaN(this.maxColorRate)?6e3:this.maxColorRate,Je.gcodeProcessor.colorMode=this.feedColoring?ze.Feed:ze.Color},resetExtruderColors:function(){var e=this;this.extruderColors=["#00FFFF","#FF00FF","#FFFF00","#000000","#FFFFFF"],Je.saveExtruderColors(this.extruderColors),this.extruderColors.forEach((function(t,i){e.$set(e.extruderColors,i,t)})),this.extruderColors=Je.getExtruderColors()},loadBenchy:function(){var e=this;return Object(k["a"])(regeneratorRuntime.mark((function t(){var i,r,s;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return e.loading=!0,t.next=3,fetch("./benchy_color.gcode");case 3:return i=t.sent,t.next=6,i.blob();case 6:return r=t.sent,t.next=9,r.text();case 9:if(s=t.sent,void 0!==r){t.next=12;break}return t.abrupt("return");case 12:return e.updateViewerSettings(),Je.gcodeProcessor.updateFilePosition(s.length),t.next=16,Je.processFile(s);case 16:e.fileSize=Je.fileSize;case 17:case"end":return t.stop()}}),t)})))()}},watch:{filePosition:function(e){Je.gcodeProcessor.updateFilePosition(e)}}},Ke=Xe,Ye=(i("ee17"),i("ac7c")),_e=i("f774"),$e=i("8e36"),et=i("ba0d"),tt=i("269a"),it=i.n(tt),rt=i("dc22"),st=Object(l["a"])(Ke,ae,le,!1,null,"44b3d1f8",null),nt=st.exports;c()(st,{VBtn:g["a"],VCheckbox:Ye["a"],VCol:H["a"],VIcon:A["a"],VNavigationDrawer:_e["a"],VProgressLinear:$e["a"],VRow:N["a"],VSelect:se["a"],VSlider:et["a"],VTextField:G["a"]}),it()(st,{Resize:rt["a"]}),r["default"].component("color-picker",q),r["default"].component("tool-configuration",oe),r["default"].component("asmbl-viewer",nt);var ot=i("2f62");r["default"].config.productionTip=!1,r["default"].use(C.a),r["default"].use(ot["a"]),new r["default"]({render:function(e){return e(m)},vuetify:new C.a({theme:{dark:!0},icons:{iconfont:"mdiSvg"}})}).$mount("#app")},"586d":function(e,t,i){},5983:function(e,t,i){},"85ec":function(e,t,i){},d200:function(e,t,i){},ee17:function(e,t,i){"use strict";i("d200")}});
//# sourceMappingURL=app.dd12998a.js.map