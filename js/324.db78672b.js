"use strict";(self["webpackChunkgcodeviewer_site"]=self["webpackChunkgcodeviewer_site"]||[]).push([[324],{50324:function(t,e,a){a.r(e),a.d(e,{_HDRTextureLoader:function(){return c}});var r=a(25412);class n{static ConvertPanoramaToCubemap(t,e,a,r,n=!1){if(!t)throw"ConvertPanoramaToCubemap: input cannot be null";if(t.length!=e*a*3)throw"ConvertPanoramaToCubemap: input size is wrong";const o=this.CreateCubemapTexture(r,this.FACE_FRONT,t,e,a,n),i=this.CreateCubemapTexture(r,this.FACE_BACK,t,e,a,n),h=this.CreateCubemapTexture(r,this.FACE_LEFT,t,e,a,n),w=this.CreateCubemapTexture(r,this.FACE_RIGHT,t,e,a,n),s=this.CreateCubemapTexture(r,this.FACE_UP,t,e,a,n),u=this.CreateCubemapTexture(r,this.FACE_DOWN,t,e,a,n);return{front:o,back:i,left:h,right:w,up:s,down:u,size:r,type:1,format:4,gammaSpace:!1}}static CreateCubemapTexture(t,e,a,r,n,o=!1){const i=new ArrayBuffer(t*t*4*3),h=new Float32Array(i),w=o?Math.max(1,Math.round(r/4/t)):1,s=1/w,u=s*s,l=e[1].subtract(e[0]).scale(s/t),c=e[3].subtract(e[2]).scale(s/t),f=1/t;let d=0;for(let C=0;C<t;C++)for(let o=0;o<w;o++){let o=e[0],i=e[2];for(let e=0;e<t;e++)for(let s=0;s<w;s++){const w=i.subtract(o).scale(d).add(o);w.normalize();const s=this.CalcProjectionSpherical(w,a,r,n);h[C*t*3+3*e+0]+=s.r*u,h[C*t*3+3*e+1]+=s.g*u,h[C*t*3+3*e+2]+=s.b*u,o=o.add(l),i=i.add(c)}d+=f*s}return h}static CalcProjectionSpherical(t,e,a,r){let n=Math.atan2(t.z,t.x);const o=Math.acos(t.y);while(n<-Math.PI)n+=2*Math.PI;while(n>Math.PI)n-=2*Math.PI;let i=n/Math.PI;const h=o/Math.PI;i=.5*i+.5;let w=Math.round(i*a);w<0?w=0:w>=a&&(w=a-1);let s=Math.round(h*r);s<0?s=0:s>=r&&(s=r-1);const u=r-s-1,l=e[u*a*3+3*w+0],c=e[u*a*3+3*w+1],f=e[u*a*3+3*w+2];return{r:l,g:c,b:f}}}function o(t,e){return e>1023?t*Math.pow(2,1023)*Math.pow(2,e-1023):e<-1074?t*Math.pow(2,-1074)*Math.pow(2,e+1074):t*Math.pow(2,e)}function i(t,e,a,r,n,i){n>0?(n=o(1,n-136),t[i+0]=e*n,t[i+1]=a*n,t[i+2]=r*n):(t[i+0]=0,t[i+1]=0,t[i+2]=0)}function h(t,e){let a="",r="";for(let n=e;n<t.length-e;n++){if(r=String.fromCharCode(t[n]),"\n"==r)break;a+=r}return a}function w(t){let e=0,a=0,r=h(t,0);if("#"!=r[0]||"?"!=r[1])throw"Bad HDR Format.";let n=!1,o=!1,i=0;do{i+=r.length+1,r=h(t,i),"FORMAT=32-bit_rle_rgbe"==r?o=!0:0==r.length&&(n=!0)}while(!n);if(!o)throw"HDR Bad header format, unsupported FORMAT";i+=r.length+1,r=h(t,i);const w=/^-Y (.*) \+X (.*)$/g,s=w.exec(r);if(!s||s.length<3)throw"HDR Bad header format, no size";if(a=parseInt(s[2]),e=parseInt(s[1]),a<8||a>32767)throw"HDR Bad header format, unsupported size";return i+=r.length+1,{height:e,width:a,dataPosition:i}}function s(t,e){return u(t,e)}function u(t,e){let a=e.height;const r=e.width;let n,o,h,w,s,u=e.dataPosition,c=0,f=0,d=0;const C=new ArrayBuffer(4*r),p=new Uint8Array(C),P=new ArrayBuffer(e.width*e.height*4*3),g=new Float32Array(P);while(a>0){if(n=t[u++],o=t[u++],h=t[u++],w=t[u++],2!=n||2!=o||128&h||e.width<8||e.width>32767)return l(t,e);if((h<<8|w)!=r)throw"HDR Bad header format, wrong scan line width";for(c=0,d=0;d<4;d++){f=(d+1)*r;while(c<f)if(n=t[u++],o=t[u++],n>128){if(s=n-128,0==s||s>f-c)throw"HDR Bad Format, bad scanline data (run)";while(s-- >0)p[c++]=o}else{if(s=n,0==s||s>f-c)throw"HDR Bad Format, bad scanline data (non-run)";if(p[c++]=o,--s>0)for(let e=0;e<s;e++)p[c++]=t[u++]}}for(d=0;d<r;d++)n=p[d],o=p[d+r],h=p[d+2*r],w=p[d+3*r],i(g,n,o,h,w,(e.height-a)*r*3+3*d);a--}return g}function l(t,e){let a=e.height;const r=e.width;let n,o,h,w,s,u=e.dataPosition;const l=new ArrayBuffer(e.width*e.height*4*3),c=new Float32Array(l);while(a>0){for(s=0;s<e.width;s++)n=t[u++],o=t[u++],h=t[u++],w=t[u++],i(c,n,o,h,w,(e.height-a)*r*3+3*s);a--}return c}n.FACE_LEFT=[new r.P(-1,-1,-1),new r.P(1,-1,-1),new r.P(-1,1,-1),new r.P(1,1,-1)],n.FACE_RIGHT=[new r.P(1,-1,1),new r.P(-1,-1,1),new r.P(1,1,1),new r.P(-1,1,1)],n.FACE_FRONT=[new r.P(1,-1,-1),new r.P(1,-1,1),new r.P(1,1,-1),new r.P(1,1,1)],n.FACE_BACK=[new r.P(-1,-1,1),new r.P(-1,-1,-1),new r.P(-1,1,1),new r.P(-1,1,-1)],n.FACE_DOWN=[new r.P(1,1,-1),new r.P(1,1,1),new r.P(-1,1,-1),new r.P(-1,1,1)],n.FACE_UP=[new r.P(-1,-1,-1),new r.P(-1,-1,1),new r.P(1,-1,-1),new r.P(1,-1,1)];class c{constructor(){this.supportCascades=!1}loadCubeData(){throw".env not supported in Cube."}loadData(t,e,a){const r=new Uint8Array(t.buffer,t.byteOffset,t.byteLength),n=w(r),o=s(r,n),i=n.width*n.height,h=new Float32Array(4*i);for(let w=0;w<i;w+=1)h[4*w]=o[3*w],h[4*w+1]=o[3*w+1],h[4*w+2]=o[3*w+2],h[4*w+3]=1;a(n.width,n.height,e.generateMipMaps,!1,(()=>{const t=e.getEngine();e.type=1,e.format=5,e._gammaSpace=!1,t._uploadDataToTextureDirectly(e,h)}))}}}}]);
//# sourceMappingURL=324.db78672b.js.map